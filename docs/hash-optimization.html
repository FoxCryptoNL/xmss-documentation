<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta charset="utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>XMSS Library: Hash optimization</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="katex.min.css" rel="stylesheet" type="text/css"/>
<!-- KaTeX -->
<script type="text/javascript" defer src="katex.min.js"></script>
<script type="text/javascript" defer src="auto-render.min.js"></script>
<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            macros: {
                '\\Keccak': '\\text{K\\footnotesize{ECCAK}}'
            }
        });
    });
</script>
<!-- end: KaTeX -->
<!-- Doxygen Awesome -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
</script>
<!-- end: Doxygen Awesome -->
<!-- Final overrides (glue) -->
<link href="custom.css" rel="stylesheet" type="text/css"/>
<!-- end: Final overrides (glue) -->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="FOX-CRYPTO.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">XMSS Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('hash-optimization.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Hash optimization </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md20">Problem definition</a></li>
<li class="level1"><a href="#autotoc_md21">Optimization options</a></li>
<li class="level1"><a href="#autotoc_md22">Disabling a hash algorithm</a></li>
<li class="level1"><a href="#autotoc_md23">Overriding a hash algorithm</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md__home_gitlab_runner_builds_Ybiz_PBn_0_crypto_xmss_documentation_build_docs_0060_hash_optimization"></a></p>
<h1><a class="anchor" id="autotoc_md20"></a>
Problem definition</h1>
<p>The library provides a software solution for XMSS. XMSS is based on a lot of hashes using one of two algorithms: SHA-256 and/or SHAKE256/256. The library is portable; it supports 32-bit and 64-bit hardware platforms, both little endian and big endian. Many hardware platforms have options that can accelerate those hash functions. Utilizing such hardware options not only makes the library more performant, it also decreases the footprint since the software implementation is no longer required. Therefore, the library allows for overriding its default implementations of SHA-256 and/or SHAKE256/256.</p>
<p>This document provides guidance on when and how to optimize the hash algorithms.</p>
<h1><a class="anchor" id="autotoc_md21"></a>
Optimization options</h1>
<p>The library consists of two parts: signing and verification. The verification library has been written such that it optimizes binary code size. The signing library has been written such that it optimizes robustness and versatility. Often, the hardware platform for the signing and the verification are different. Hence, the rationale for optimization is also different for both parts of the library.</p>
<p>The library allows for the following optimizations:</p>
<ul>
<li>disabling either SHA-256 or SHAKE256/256, if that specific hash algorithm is not used</li>
<li>override either (or both) algorithms, if hardware acceleration is available on the target platform</li>
</ul>
<p>For the signing library, disabling an algorithm is not very relevant. The signing library is not optimized for size anyway and disabling an algorithm only improves performance marginally. Performance can be improved by utilizing hardware acceleration, but it mostly effects key generation, which is a one-time initialization.</p>
<p>For the verification library, disabling an algorithm improves both performance and footprint. If the parameter set(s) for signatures is chosen such that only one of the hash algorithms is used in practice, it makes sense to disable the unused algorithm. If hardware acceleration is available, then providing an override also improves both performance and footprint.</p>
<p>There are two ways of overriding a default hash implementation. It is preferred to use the internal block format of the library, but it requires that your alternative implementation is compatible with it. If not, it is possible to override using a generic digest interface, albeit with less optimization benefits.</p>
<p>An override with an alternative software implementation, optimized for the specific bitness and endianness of the target platform, may improve performance. However, the provided default implementations are already optimized and the marginal improvement obtained by providing an alternative software implementation may not be worth the trouble. An override with an alternative software implementation using the generic interface will almost certainly be bigger <em>and</em> slower than the the default implementation. In general, it will only be worthwhile to invest in an alternative hash implementation if it utilizes some form of hardware acceleration.</p>
<p>When hardware acceleration is available, then it certainly is worthwhile to override the default implementation. The software code that implements a hash algorithm is quite a substantial portion of the library and replacing it with either a few dedicated assembly instructions or with a call to an embedded crypto engine will reduce both the binary code size as well as the execution time.</p>
<p>Per target platform and per algorithm, consider the following decision tree for optimization:</p>
<pre class="mermaid">
flowchart TD
    optimization_required{Is optimization\nrequired?}
        optimization_required --&gt;|no| done((Done))

        optimization_required --&gt;|yes| algorithm_required{Is the hash\nalgorithm\nrequired?}

        algorithm_required --&gt;|no| disable_algorithm[[Compile with\nXMSS_XXX=Disabled]]
        disable_algorithm --&gt; done

        algorithm_required --&gt;|yes| support_internal{Does the optimized\nimplementation support\nthe internal interface?}
            support_internal --&gt;|yes| implement_internal[[Implement the\ninternal interface]]
            implement_internal --&gt; configure_internal[[Compile with\nXMSS_XXX=OverrideInternal]]
            configure_internal --&gt; done

            support_internal --&gt;|no| implement_generic[[Implement the\ngeneric interface]]
            implement_generic --&gt; configure_generic[[Compile with\nXMSS_XXX=OverrideGeneric]]
            configure_generic --&gt; done
</pre><p>To override the SHA-256 algorithm, use the CMake variable <code>XMSS_SHA256</code>; to override the SHAKE256/256 algorithm, use the CMake variable <code>XMSS_SHAKE256_256</code>.</p>
<h1><a class="anchor" id="autotoc_md22"></a>
Disabling a hash algorithm</h1>
<p>This option must not be selected if the verification library should be able to verify signatures generated by third parties and when it cannot be guaranteed which hash algorithm the third party signer will use.</p>
<p>If, on the other hand, a selection for a single hash algorithm can definitively be made, then it is actually recommended to disable the unused algorithm. This not only removes the unused algorithm from the binary, but it also removes all code to select between the algorithms, reducing the binary size even further as well as improving the execution speed slightly.</p>
<h1><a class="anchor" id="autotoc_md23"></a>
Overriding a hash algorithm</h1>
<dl class="section warning"><dt>Warning</dt><dd>Overriding a default hash implementation has implications for evaluation/certification of your product.</dd></dl>
<p>The default hash implementations were subject to the same development security as the development of the other parts of the XMSS library. When you override a hash algorithm, it is your responsibility to provide sufficient assurance to any auditors/evaluators/certifiers that the relevant development standards are met.</p>
<p>The library uses an optimized internal format for intermediate hash values and message blocks. If your hardware platform is compatible with this internal format, it is preferred to use this internal override option. For example, this format is compatible with the SHA extensions in modern Intel processors (<code>SHA256RNDS2</code>, <code>SHA256MSG1</code>, <code>SHA256MSG2</code>) and with the ARMv8 SHA-256 extensions (<code>sha256h</code>, <code>sha256h2</code>, <code>sha256su0</code>, <code>sha256su1</code>). For hardware platforms that have cryptographic engines that do not provide access to their internal state, the generic override interface can be used instead.</p>
<p>To provide an override, compile the library with <code>XMSS_SHA256</code> and/or <code>XMSS_SHAKE256_256</code> defined to either <code>OverrideInternal</code> (preferred) or <code>OverrideGeneric</code>.</p>
<p>Your override implementation should include one of the following headers that provide the prototypes for the functions to implement:</p>
<ul>
<li><a class="el" href="override__sha256__internal_8h.html" title="Prototype for the SHA-256 hash function override using the internal interface.">override_sha256_internal.h</a></li>
<li><a class="el" href="override__sha256__generic_8h.html" title="Prototypes for the SHA-256 hash function override using the generic interface.">override_sha256_generic.h</a></li>
<li><a class="el" href="override__shake256__256__internal_8h.html" title="Prototypes for the SHAKE256/256 hash function override using the internal interface.">override_shake256_256_internal.h</a></li>
<li><a class="el" href="override__shake256__256__generic_8h.html" title="Prototypes for the SHAKE256/256 hash function override using the generic interface.">override_shake256_256_generic.h</a></li>
</ul>
<p>Additionally, to override either or both algorithms, you will have to provide additional source files to compile and/or additional libraries to link with. To provide additional source files, use the CMake variable <code>XMSS_HASH_OVERRIDE_SOURCES</code>; to provide additional libraries to link with, use the CMake variable <code>XMSS_HASH_OVERRIDE_LINK_LIBRARIES</code>. The provided hash override(s) will be tested by <code>make test</code> against the NIST Known Answer Tests (KATs). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
<!-- Mermaid -->
<script type="text/javascript" defer src="mermaid.min.js"></script>
<!-- end: Mermaid -->
</html>
